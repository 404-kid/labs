<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ribbons</title>
    <link rel="stylesheet" type="text/css" href="normalise.css">
    <style type="text/css">
    body { font-family: monospace; }
    </style>
</head>
<body>
    <script type="x-shader/x-vertex" id="vertexshader-ribbon">

        // switch on high precision floats
        #ifdef GL_ES
            precision highp float;
        #endif

        varying vec3 N;
        varying vec4 V;
        
        void main( void ) {
            N = normal;
            gl_Position = V = projectionMatrix * modelViewMatrix * vec4(position,1.0);
        }

    </script>
    <script type="x-shader/x-fragment" id="fragmentshader">
        
        // switch on high precision floats
        #ifdef GL_ES
            precision highp float;
        #endif

        varying vec3 N;
        varying vec4 V;
        uniform vec3 color;

        void main( void ) {

            // tweak
            float irStrength = 2.7;
            float irSpread   = 10.1;

            float specStrength  = 0.1;
            vec3 mspecular      = vec3(specStrength,specStrength,specStrength); //?

            vec3 lightPosition = vec3(0.0, 100.0, -1000.0);
            vec3 L = normalize(lightPosition - V.xyz);
            vec3 norm = normalize(N);

            if ( dot(norm, L) < 0.0 ){
                norm = -norm; // flip normal, we lit thing same ways both sides
            }

            vec4 v4 = vec4(color , 1.0);
            vec4 ambient = v4 * dot(norm,L);

            max( dot(norm,L), 0.0 );
            ambient.w = 1.0;
            
            vec3 t = vec3(lightPosition.x, lightPosition.y, V.z);

            float lS = 1.0;
            vec3 lspecular = vec3( lS, lS, lS );
            float shinyness     = 0.9;

            // specular
            vec3 refl           = -reflect(L, norm);
            vec3 surfToView     = -normalize(V.xyz); 
            float specContrib   = pow( max( 0.0, dot( surfToView, refl )), shinyness);
            vec4 specular       = vec4( lspecular.xyz * mspecular * specContrib, 1.0);

            // iridescence
            vec3 irRefl         = -reflect(-V.xyz, norm);
            float irContrib     = pow( max(0.0, dot( surfToView, refl )), irSpread);
            
            vec3 c = vec3(irContrib, 0.7, 0.1);
            vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
            vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
            vec3 irCol = c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);

            vec3 ir = (1.0*irContrib)* irCol ;
            vec4 iridescence = vec4( ir, 1.0)*irStrength;

            vec4 c4 = vec4( specular + ambient + iridescence ) + vec4( 0.0, 0.0, 0.0, 1.0);
            gl_FragColor = c4;

        }
        
    </script>
    <script src="bundle.js"></script>
</body>

</html>